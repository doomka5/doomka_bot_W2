# Doomka Bot W2 — FastAPI Web Panel

Эта директория содержит FastAPI-панель управления для CRM-бота. Веб-приложение
работает в том же Docker-проекте и подключается к той же базе PostgreSQL, что и
Telegram-бот.

## Зависимости

Все необходимые пакеты перечислены в [`requirements.txt`](requirements.txt).
Они обеспечивают работу FastAPI с шаблонами (Jinja2), обработкой форм
(`Form()`), статическими файлами и асинхронным доступом к PostgreSQL через
`asyncpg`. Python 3.11 уже включён в образ `python:3.11-slim`, который
используется в Dockerfile.

## Быстрый старт на QNAP

1. Перейдите в каталог проекта на NAS и убедитесь, что там есть файл
   `docker-compose.yml`.
2. Заполните переменные окружения для подключения к БД. Их можно передать через
   `docker-compose.yml`, `.env` или прямо в командной строке:

   ```bash
   export DB_HOST=postgres_bot
   export DB_PORT=5432
   export DB_NAME=botdb
   export DB_USER=botuser
   export DB_PASS=botpass
   ```

3. Запустите веб-панель (и необходимые зависимости) командой:

   ```bash
   docker compose up -d fastapi_web
   ```

   Сервис подключается к сети `botnet`, поэтому он автоматически увидит
   PostgreSQL и Telegram-бота, если они запускаются тем же `docker compose`.

4. Панель будет доступна на порту **8181** NAS-устройства. Контейнер слушает
   порт 8181 и пробрасывает его наружу.

5. Для проверки логов используйте:

   ```bash
   docker logs -f fastapi_web
   ```

6. Для доступа внутрь контейнера и проверки файлов:

   ```bash
   docker exec -it fastapi_web /bin/bash
   ```

   Код приложения находится в каталоге `/app` внутри контейнера.

## Структура директории

```
web/
├── Dockerfile        # Сборка образа FastAPI
├── main.py           # Точка входа FastAPI-приложения
├── requirements.txt  # Python-зависимости
├── templates/        # HTML-шаблоны Jinja2 (создайте при необходимости)
└── static/           # Статические файлы (CSS, JS, изображения; создайте при необходимости)
```

Каталоги `templates/` и `static/` должны располагаться рядом с `main.py`, чтобы
FastAPI мог находить HTML-страницы и статические ресурсы.

## Обновление контейнера

После изменения кода или зависимостей обновите образ и перезапустите сервис:

```bash
docker compose up -d --build fastapi_web
```

Эта команда пересоберёт образ, установит новые зависимости из
`requirements.txt` и перезапустит контейнер без остановки других сервисов.
