{% extends "base.html" %}

{% block title %}–õ–∏—Å—Ç–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚Äî Doomka W2{% endblock %}

{% block content %}
<section class="page-header">
    <h2>üìÑ –õ–∏—Å—Ç–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h2>
    <div class="page-actions">
        <a class="button" href="{{ export_url }}">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
    </div>
</section>

{% if message %}
<div class="alert success">{{ message }}</div>
{% endif %}
{% if error %}
<div class="alert error">{{ error }}</div>
{% endif %}

<form method="get" class="toolbar filters">
    <div class="field-group">
        <label for="search">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–ª—è–º:</label>
        <input type="text" id="search" name="search" value="{{ search }}" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è">
    </div>
    <div class="field-group">
        <label for="material">–ú–∞—Ç–µ—Ä–∏–∞–ª:</label>
        <select id="material" name="material">
            <option value="">–í—Å–µ</option>
            {% for option in filter_options.get('material', []) %}
                <option value="{{ option.value }}" {% if filters.get('material') == option.value %}selected{% endif %}>{{ option.label }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="field-group">
        <label for="color">–¶–≤–µ—Ç:</label>
        <select id="color" name="color">
            <option value="">–í—Å–µ</option>
            {% for option in filter_options.get('color', []) %}
                <option value="{{ option.value }}" {% if filters.get('color') == option.value %}selected{% endif %}>{{ option.label }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="field-group">
        <label for="thickness">–¢–æ–ª—â–∏–Ω–∞:</label>
        <select id="thickness" name="thickness">
            <option value="">–í—Å–µ</option>
            {% for option in filter_options.get('thickness', []) %}
                <option value="{{ option.value }}" {% if filters.get('thickness') == option.value %}selected{% endif %}>{{ option.label }}</option>
            {% endfor %}
        </select>
    </div>
    <input type="hidden" name="sort" value="{{ sort }}">
    <input type="hidden" name="order" value="{{ order }}">
    <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <a class="button secondary" href="{{ url_for('materials_page') }}">–°–±—Ä–æ—Å–∏—Ç—å</a>
</form>

<form action="{{ url_for('import_table', table_alias='materials') }}" method="post" enctype="multipart/form-data" class="toolbar">
    <label for="materials-file">–ò–º–ø–æ—Ä—Ç –∏–∑ Excel (.xlsx):</label>
    <input type="file" id="materials-file" name="file" accept=".xlsx" required>
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
</form>

<div class="table-wrapper">
    <table>
        <thead>
            <tr>
            {% for column in columns %}
                {% set next_order = 'desc' if sort == column.name and order == 'asc' else 'asc' %}
                <th>
                    <a href="{{ url_with_query(request, route_name, search=search, sort=column.name, order=next_order, material=filters.get('material'), color=filters.get('color'), thickness=filters.get('thickness')) }}">
                        {{ column.title }}
                        {% if sort == column.name %}
                            <span class="sort-indicator">{{ '‚Üë' if order == 'asc' else '‚Üì' }}</span>
                        {% endif %}
                    </a>
                </th>
            {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% for row in rows %}
            <tr>
            {% for column in columns %}
                <td>{{ row[column.name] | format_value }}</td>
            {% endfor %}
            </tr>
        {% else %}
            <tr>
                <td class="empty" colspan="{{ columns|length }}">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
