# üß† Doomka Bot W2

**–ü—Ä–∏–≤–∞—Ç–Ω—ã–π Telegram-–±–æ—Ç** —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –Ω–∞ FastAPI.  
–†–∞–∑–≤—ë—Ä–Ω—É—Ç –Ω–∞ **QNAP NAS** —Å –ø–æ–º–æ—â—å—é Docker Compose.  
–ö–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Codex**, –∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å GitHub.

---

## ‚öôÔ∏è –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
doomka_bot_W2/
‚îú‚îÄ‚îÄ bot/                  # –ö–æ–¥ Telegram-–±–æ—Ç–∞ (Aiogram)
‚îÇ   ‚îî‚îÄ‚îÄ bot.py
‚îú‚îÄ‚îÄ web/                  # FastAPI –≤–µ–±-—Å–µ—Ä–≤–∏—Å, —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å —Ç–æ–π –∂–µ –±–∞–∑–æ–π
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ pgdata/               # –î–∞–Ω–Ω—ã–µ PostgreSQL
‚îú‚îÄ‚îÄ docker-compose.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

---

## üß© –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-------------|-------|-----------|
| **postgres_bot** | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL | 5432 | –•—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ç–æ–≤–∞—Ä—ã, —Å–∫–ª–∞–¥, –∑–∞–∫–∞–∑—ã –∏ —Ç.–¥. |
| **telegram_bot** | Telegram-–±–æ—Ç (–Ω–∞ Aiogram 3.x) | ‚Äî | –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É |
| **fastapi_web** | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (FastAPI) | 8181 | –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∏ API –¥–ª—è n8n / CRM |

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–µ–¥–∏–Ω–µ–Ω—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç—å—é `botnet`.

---

## üîê –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø

–≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `docker-compose.yml` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–¥–µ –±–æ—Ç–∞ –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

| –ò–º—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----------|--------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞ (–∏–∑ [@BotFather](https://t.me/BotFather))  |
| `DB_HOST` | –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å PostgreSQL | postgres_bot |
| `DB_PORT` | –ü–æ—Ä—Ç PostgreSQL | 5432 |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | botdb |
| `DB_USER` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è PostgreSQL | botuser |
| `DB_PASS` | –ü–∞—Ä–æ–ª—å PostgreSQL | botpass |

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –Ω–µ –≤—Å—Ç–∞–≤–ª—è–π —Ç–æ–∫–µ–Ω –∏ –ø–∞—Ä–æ–ª–∏ –≤ –∫–æ–¥ ‚Äî –æ–Ω–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏.  
> –í Python –∫–æ–¥–µ –ø–æ–ª—É—á–∞–π –∏—Ö —Ç–∞–∫:
> ```python
> import os
> BOT_TOKEN = os.getenv("BOT_TOKEN")
> DB_USER = os.getenv("DB_USER")
> ```

---

## üöÄ –ó–ê–ü–£–°–ö –ù–ê QNAP

1. –°–∫–æ–ø–∏—Ä—É–π –ø—Ä–æ–µ–∫—Ç –≤ –ø–∞–ø–∫—É:
   ```bash
   /share/3D/doomka_bot_W2
   ```

2. –°–æ–±–µ—Ä–∏ –∏ –∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
   ```bash
   cd /share/3D/doomka_bot_W2
   docker compose build --no-cache
   docker compose up -d
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
   ```bash
   docker ps
   ```

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```bash
   docker logs telegram_bot -f
   docker logs fastapi_web -f
   ```

5. FastAPI –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:  
   üëâ http://192.168.0.105:8181

---

## ü§ñ TELEGRAM-–ë–û–¢

–ë–æ—Ç –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ **Aiogram 3.x** –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø.  
–ü—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–¥–∞ (`bot/bot.py`):

```python
import os
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
import asyncio

BOT_TOKEN = os.getenv("BOT_TOKEN")
ALLOWED_USERS = {37352491}  # –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ Telegram ID

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

@dp.message(Command("start"))
async def start_handler(message: types.Message):
    if message.from_user.id not in ALLOWED_USERS:
        await message.answer("‚õî –£ —Ç–µ–±—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É.")
        return
    await message.answer("‚úÖ –ü—Ä–∏–≤–µ—Ç! –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω.")

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
```

---

## üåê –í–ï–ë-–°–ï–†–í–ò–° (FASTAPI)

–§–∞–π–ª: `web/main.py`

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `users` –∏ –æ—Ç–¥–∞—ë—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–î–æ—Å—Ç—É–ø:  
üëâ [http://192.168.0.105:8181](http://192.168.0.105:8181)

---

## üß† –†–ê–ë–û–¢–ê –ß–ï–†–ï–ó CODEX

1. –û—Ç–∫—Ä–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π **doomka_bot_W2** –≤ Codex.  
2. –í–Ω–æ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥ (`bot/` –∏–ª–∏ `web/`).  
3. –°–æ—Ö—Ä–∞–Ω–∏ –∏ –∑–∞–∫–æ–º–º–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub.  
4. –ù–∞ QNAP –æ–±–Ω–æ–≤–∏ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   cd /share/3D/doomka_bot_W2
   git pull origin main
   docker compose build bot
   docker compose up -d bot
   ```

---

## üîí –ü–†–ò–í–ê–¢–ù–û–°–¢–¨

- –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**.  
- –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ ID –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É `employees` –≤ –±–∞–∑–µ.  
- –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç—å—é (192.168.x.x).

---

## üß© –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

–ë–æ—Ç –∏ –≤–µ–± –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –±–∞–∑–∞ –¥–ª—è:
- Google Sheets —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ gspread)
- n8n workflow automation
- CRM-–ø–∞–Ω–µ–ª–∏
- —Å–∫–ª–∞–¥—Å–∫–æ–≥–æ —É—á—ë—Ç–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üí° –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
docker logs telegram_bot --tail 50

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ
docker exec -it postgres_bot psql -U botuser -d botdb

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
\dt
```

---

## üõ† –ê–í–¢–û–†

üë®‚Äçüíª **Doomka / Jaros≈Çaw Iwanow**  
Telegram: [@doomka5pl](https://t.me/doomka5pl)  
GitHub: [github.com/doomka5](https://github.com/doomka5)
